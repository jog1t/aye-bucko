version: "3"
services:
   black-pearl:
      image: aye-bucko/black-pearl:${BRANCH_NAME}
      links:
         - whydah
      networks:
         - reverse_proxy_default
      ports:
         - "443:80"
      labels:
         - traefik.enable=true
         - traefik.http.routers.black-pearl.rule=Host(`${FRONTEND_HOST}`)
         - traefik.http.routers.black-pearl.entrypoints=websecure
         - traefik.http.routers.black-pearl.tls.certresolver=tls-challenge
         - traefik.docker.network=reverse_proxy_default

   whydah:
      image: aye-bucko/whydah:${BRANCH_NAME}
      networks:
         - reverse_proxy_default
      ports:
         - "443:3000"
      labels:
         - traefik.enable=true
         - traefik.http.routers.whydah.rule=Host(`${BACKEND_HOST}`)
         - traefik.http.routers.whydah.entrypoints=websecure
         - traefik.http.routers.whydah.tls.certresolver=tls-challenge
         - traefik.docker.network=reverse_proxy_default
